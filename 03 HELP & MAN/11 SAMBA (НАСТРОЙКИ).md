# Что такое Samba?
 > Samba - серверное приложение, реализующее доступ клиентских терминалов к папкам, принтерам и дискам про протоколу SMB/CIFS.

![](https://serverspace.ru/wp-content/uploads/2020/06/36_1.png)

# НАСТРОЙКИ SAMBA

## Устанавливаем пакеты:
```
sudo yay -S samba smbclient gvfs-smb cifs-utils
```
# Настройка общих папок 

## Изменим права доступа к каталогу Downloads чтобы разшарить его даем полный доступ на запись и удаление:
```
chmod 777 ./Downloads 
```
## С помощью инструментов Samba создадим пароль для пользователя который будет админом для samba:
```
sudo smbpasswd -a $USER
```
## С помощью текстового редактора, например, nano, создаем и редактируем конфигурационный файл samba:
```
sudo nano /etc/samba/smb.conf
```
## Удаляем все строки из файла. Вставляем следующие::
```
[Downloads]
path = /home/orr/Downloads
valid users = orr
read only = no
browsable = yes
writable = yes
```
Сохраняем используя сочетание Ctrl + X, затем нажимаем Y и Enter.

## [Пример и пояснение конфигурации.](https://serverspace.ru/support/help/configuring-samba/#step1)
```
[global]
workgroup = WORKGROUP
security = user
map to guest = bad user
wins support = no
dns proxy = no

[public]
path = /media/samba/public
guest ok = yes
force user = nobody
browsable = yes
writable = yes

[private]
path = /media/samba/private
valid users = @smbgrp
guest ok = no
browsable = yes
writable = yes

конфигурационный файл состоит из трех секций:

global - данная секция отвечает за общие настройки Samba-сервера;
public и private - секции описания настроек директорий общего доступа.

В секции global присутствуют пять параметров:

workgroup - рабочая группа. Для упрощения работы пользователей WORKGROUP указывается, как группа по умолчанию. Если в вашей сети имя рабочей группы изменено, то следует изменить это значение и для Samba;
security - уровень безопасности сервера. Значение user означает авторизацию по паре логин/пароль;
map to guest - параметр определяет способ обработки запросов. Значение bad user означает, что запросы с неправильным паролем будут отклонены, даже если такое имя пользователя существует;
wins support - включить или выключить поддержку WINS;
dns proxy - возможность проксирования запросов к DNS.
Настройки директорий выполняются в соответствующих секциях:

path - полный путь до директории на жестком диске;
guest ok - возможность доступа к каталогу без пароля (гостевой);
browsable - показывать ли каталог (“шару”) на сервере среди прочих. Если параметр установлен как “no”, то доступ будет возможен по полному пути, например ip-addresshidden_directory;
force user - пользователь от которого ведется работа с каталогом. Для повышения безопасности сервера, обычно используют nobody. Главное, не использовать пользователя root - это небезопасно.
writable - установка значения как “yes” позволяет пользователю выполнять действия над файлами внутри каталога - переименование, добавление, удаление, перемещение в подкаталог и копирование;
valid users - список пользователей у которых есть доступ к каталогу. Если пользователей несколько, их имена указываются через запятую. Если необходим доступ для пользователей принадлежащих группе, перед именем группы устанавливается символ ”at” @ (“собака”).

Важно! Имя директории общего доступа, отображаемое пользователям, равно имени секции в которой оно описано.
```

## Проверяем настройки с помощью команды:
```
testparm -s
```

# Стартуем службу:
```
sudo samba
```
Или перезапускаем сервер:
```
systemctl restart smb 
```
## Создаем запись для автозапуска при входе в систему.
```
sudo systemctl enable smb.service
```
# Настроим межсетевой экран. 

В программе GUFW создадим для SAMBA правила: откроем TCP-порты 139 и 445, а также UDP-порты 137 и 138.

# Проверка:

```
smb://192.168.0.102
```
Должна открыться папка в которой будет сетевая папка "Downloads"
